# üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WebRTC –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ WebRTC-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.
–ù–∏–∂–µ ‚Äî –º–∏–Ω–∏–º—É–º –¥–µ–π—Å—Ç–≤–∏–π, —á—Ç–æ–±—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–º–µ–Ω–∏–≤–∞–ª–∏—Å—å
—Å–∏–≥–Ω–∞–ª–∞–º–∏ –∏ –≤–∏–¥–µ–æ—Å–µ—Å—Å–∏—è–º–∏.

## 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ Supabase

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ `supabase/migrations/20251017_video_call_core.sql` (—Å–æ–∑–¥–∞—ë—Ç
   —Ç–∞–±–ª–∏—Ü—ã `video_call_sessions`, `video_call_participants`, `video_call_signals`
   –∏ –ø–æ–ª–∏—Ç–∏–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è realtime-–¥–æ—Å—Ç—É–ø–∞).
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `calendar_events` —É–∂–µ –µ—Å—Ç—å –ø–æ–ª—è `video_room`
   (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä WebRTC-—Å–µ—Å—Å–∏–∏) –∏ `has_video`. –ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç ‚Äî
   –¥–æ–±–∞–≤—å—Ç–µ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã—à–µ.

## 2. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å edge-—Ñ—É–Ω–∫—Ü–∏–∏

–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤ Supabase —Ç—Ä–∏ edge-—Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

- `supabase/functions/video-call-signal/` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–∏–Ω–≥–∞ (offer, answer,
  ICE-–∫–∞–Ω–¥–∏–¥–∞—Ç—ã, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞).
- `supabase/functions/video-call-cleanup/` ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –∑–∞—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö
  —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ –∞–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ ¬´–≤–∏—Å—è—â–∏—Ö¬ª —Å–µ—Å—Å–∏–π.
- `supabase/functions/webpush-send/` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–º
  –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤ Supabase Console –≤–∫–ª—é—á–∏—Ç–µ –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
`SUPABASE_URL` –∏ `SUPABASE_SERVICE_ROLE_KEY` (Service Role).

## 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä –∏ push

1. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ `VITE_VAPID_PUBLIC_KEY`.
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω (`/service-worker.js`).
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   —Å–æ—Ö—Ä–∞–Ω–∏—Ç –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ `webpush-save` –∏ –±—É–¥–µ—Ç —Å–ª–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ –∑–≤–æ–Ω–∫–∏.

## 4. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ

1. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è –æ—Ç–º–µ—Ç—å—Ç–µ —á–µ–∫–±–æ–∫—Å ¬´–í–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è¬ª. –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –µ—â—ë –Ω–µ
   —Å–æ–∑–¥–∞–Ω–∞, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã–∑–æ–≤–µ—Ç `createSession()` –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç `video_room`.
2. –ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è¬ª —Å–æ–∑–¥–∞—ë—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é, –∞ —Å—Å—ã–ª–∫–∞
   –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (`?session=<uuid>` –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   `VideoCalls`).
3. –ê–∫—Ç–∏–≤–Ω—ã–π –∑–≤–æ–Ω–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–µ—Ä—Ö–Ω–∏–º –±–ª–æ–∫–æ–º –≤ `Calendar.tsx` —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
   `WebRTCVideoCall`.

## 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

- –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—ã—Ç–∏–µ —Å –≤–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–µ–π –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–≤–æ–Ω–æ–∫.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö `video_call_sessions/participants/signals` –ø–æ—è–≤–ª—è—é—Ç—Å—è
  –∑–∞–ø–∏—Å–∏.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–∏–¥—è—Ç –∏ –ª–æ–∫–∞–ª—å–Ω—ã–π, –∏ —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Å—Ç—Ä–∏–º—ã, –∞ –∫–Ω–æ–ø–∫–∏
  —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º/–∫–∞–º–µ—Ä–æ–π —Ä–∞–±–æ—Ç–∞—é—Ç.

## ‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, —Å–æ–∑–¥–∞–π—Ç–µ —Å–æ–±—ã—Ç–∏–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ
–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —à—Ç–∞—Ç–Ω–æ.
